A simple script to test cluster example on a single computer

1) create a bat file (example.bat) with the following content:


@echo off
start "Server S1" /MIN mongod --config c:\replica\imdb_S1\imdb_S1.conf
start "Server S2" /MIN mongod --config c:\replica\imdb_S2\imdb_S2.conf
start "Server S3" /MIN mongod --config c:\replica\imdb_S3\imdb_S3.conf

2) Run the file

3) in the windows command line:
mongosh --port 27019

4) In the new mongo shell:
rs.initiate()
rs.add("localhost:25019")
rs.add("localhost:23019")
exit

Test the replica 
5)  in the windows command line:
mongosh --port 27019
use imdb
for (var i = 1; i <= 10000; i++) {
   db.movies.insert({id:i, titleType:"tvEpisode",startYear:"1980"})
}
exit

6) In the windows command line:
mongosh --port 25019
use imdb
db.movies.find()
exit

Test the Falt Tolerance

7) in the windows command line of the primary (27019)
stop the server (CTRL-C or close window)

8) Find the new primary server
 In the windows command line:
 mongosh --port 25019
(or, the this is not the primary
 mongosh --port 23019)
use imdb
for (var i = 111000; i <= 20000; i++) {
   db.movies.insert({id:i, titleType:"tvEpisode",startYear:"1980"})
}
exit

9) Restore server terminated
In the windows command line:
mongod --config \replica\imdb_S1\imdb_S1.conf

10) In the windows command line:
mongosh --port 27019
rs.secondaryOk()
use imdb
db.movies.find()
We will see 20000 documemnts
exit